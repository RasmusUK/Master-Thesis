<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Git\Master-Thesis\SpotQuoteApp\src\SpotQuoteApp.Core\ValueObjects\SellingCost.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using SpotQuoteApp.Core.ValueObjects.Enums;

namespace SpotQuoteApp.Core.ValueObjects;

public record SellingCost : BaseCost
{
    public double? MinimumValue { get; }
    public double? MaximumValue { get; }
    public double? Profit { get; }
    public new double Total { get; }

    public string Comment { get; }

    public SellingCost(
        ChargeType chargeType,
        CostType costType,
        double value,
        double weight,
        double cbm,
        string comment,
        double? minimumValue = null,
        double? maximumValue = null,
        double? profit = null
    )
        : base(chargeType, costType, value, weight, cbm)
    {
        Comment = comment;
        MinimumValue = minimumValue;
        MaximumValue = maximumValue;
        Profit = profit;
        Total = CalculateTotal(value, weight, cbm, minimumValue, maximumValue, profit, costType);
    }

    public static double CalculateTotal(
        double value,
        double weight,
        double cbm,
        double? minimumValue,
        double? maximumValue,
        double? profit,
        CostType costType
    )
    {
        var calculatedProfit = 0.0;

        if (profit is not null)
        {
            if (costType == CostType.PerKg)
                calculatedProfit = profit.Value * weight;
            else if (costType == CostType.PerCbm)
                calculatedProfit = profit.Value * cbm;
            else if (costType == CostType.PerShipment)
                calculatedProfit = profit.Value;
        }

        var min = minimumValue.GetValueOrDefault() == 0 ? null : minimumValue;
        var max = maximumValue.GetValueOrDefault() == 0 ? null : maximumValue;
        var total = BaseCost.CalculateTotal(value, weight, cbm, costType) + calculatedProfit;

        if (min is null &amp;&amp; max is null)
            return total;

        if (min is null)
            return Math.Min(max!.Value, total);

        if (max is null)
            return Math.Max(min.Value, total);

        return Math.Max(min.Value, Math.Min(max.Value, total));
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[5,15,5,26,0],[7,35,7,39,1],[8,35,8,39,1],[9,29,9,33,1],[10,31,10,35,1],[12,29,12,33,1],[25,11,25,57,1],[26,5,26,6,1],[27,9,27,27,1],[28,9,28,37,1],[29,9,29,37,1],[30,9,30,25,1],[31,9,31,98,1],[32,5,32,6,1],[43,5,43,6,1],[44,9,44,36,1],[46,9,46,32,1],[47,9,47,10,1],[48,13,48,44,1],[49,17,49,58,0],[50,18,50,50,1],[51,17,51,55,0],[52,18,52,55,1],[53,17,53,49,1],[54,9,54,10,1],[56,9,56,79,1],[57,9,57,79,1],[58,9,58,94,1],[60,9,60,40,1],[61,13,61,26,1],[63,9,63,25,0],[64,13,64,48,0],[66,9,66,25,0],[67,13,67,47,0],[69,9,69,64,0],[70,5,70,6,1]]);
    </script>
  </body>
</html>